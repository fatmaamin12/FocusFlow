<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Focus Flow | Login</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

<!-- Auth CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">

</head>
<body>

<div class="auth-wrapper">

  <!-- LOGIN BOX -->
  <div class="auth-box {% if show_signup %}hidden{% endif %}" id="loginBox">
    <h1>Welcome Back ðŸ‘‹</h1>
    <p>Sign in to your productivity hub</p>

    {% if error and not show_signup %}
      <div class="error-msg">{{ error }}</div>
    {% endif %}
    
    <form action="/login" method="POST" id="loginForm" class="auth-form">
      <div class="input-box">
        <input type="email" name="email" placeholder="Email" required>
      </div>

      <div class="input-box">
        <input type="password" name="password" placeholder="Password" required>
      </div>

      <button type="submit" class="auth-btn">Sign In</button>
    </form>

    <p class="switch">New here? <a href="#" id="showSignup">Create Account</a></p>
  </div>

  <!-- SIGNUP BOX -->
  <div class="auth-box {% if not show_signup %}hidden{% endif %}" id="signupBox">
    <h1>Create Account âœ¨</h1>
    <p>Join the productivity hub</p>

    {% if error and show_signup %}
      <div class="error-msg">{{ error }}</div>
    {% endif %}
    
    <form action="/signup" method="POST" id="signupForm" class="auth-form">
      <div class="input-box">
        <input type="text" name="name" placeholder="Full Name" required>
      </div>

      <div class="input-box">
        <input type="email" name="email" placeholder="Email" required>
      </div>

      <div class="input-box">
        <input type="password" name="password" placeholder="Password" required>
      </div>

      <button type="submit" class="auth-btn">Sign Up</button>
    </form>

    <p class="switch">Already have an account? <a href="#" id="showLogin">Sign In</a></p>
  </div>

</div>

<!-- Toggle script -->
<script>
/***************************
 * ELEMENTS
 **************************/
const loginBox = document.getElementById("loginBox");
const signupBox = document.getElementById("signupBox");
const showSignup = document.getElementById("showSignup");
const showLogin = document.getElementById("showLogin");

const signupForm = document.getElementById("signupForm");
const loginForm = document.getElementById("loginForm");

/***************************
 * TOGGLE LOGIN <-> SIGNUP
 **************************/
if (showSignup) {
  showSignup.onclick = e => {
    e.preventDefault();
    loginBox.classList.add("hidden");
    signupBox.classList.remove("hidden");
  };
}

if (showLogin) {
  showLogin.onclick = e => {
    e.preventDefault();
    signupBox.classList.add("hidden");
    loginBox.classList.remove("hidden");
  };
}

/***************************
 * SIGNUP HANDLER (frontend storage)
 **************************/
if (signupForm) {
  signupForm.addEventListener("submit", function (e) {

    // Allow Flask POST to work normally,
    // but ALSO validate full name on the frontend.
    const nameField = signupForm.querySelector("input[name='name']");
    const fullName = nameField.value.trim();

    // Full name must contain at least 2 words
    const parts = fullName.split(" ").filter(p => p.length > 0);
    if (parts.length < 2) {
      e.preventDefault();     // stop form submit
      alert("Please enter your full name (first and last).");
      nameField.focus();
      return;
    }

    // Save locally for smoother UX (optional)
    const email = signupForm.querySelector("input[name='email']").value.trim();
    const password = signupForm.querySelector("input[name='password']").value.trim();

    const user = { name: fullName, email, password };
    localStorage.setItem("user", JSON.stringify(user));
  });
}

/***************************
 * LOGIN HANDLER (frontend storage)
 **************************/
if (loginForm) {
  loginForm.addEventListener("submit", function (e) {

    // Let Flask /login handle server auth,
    // but add localStorage support for a seamless UX.
    const email = loginForm.querySelector("input[name='email']").value.trim();
    const password = loginForm.querySelector("input[name='password']").value.trim();

    const savedUser = JSON.parse(localStorage.getItem("user"));

    // If no saved user â†’ let backend do normal login
    if (!savedUser) return;

    // If localStorage user matches â†’ redirect instantly (optional)
    if (email === savedUser.email && password === savedUser.password) {
      e.preventDefault();  // prevent form POST
      alert(`Welcome back, ${savedUser.name}! âœ…`);
      window.location.href = "/dashboard";
      return;
    }

    // Otherwise let Flask login check handle mismatch normally
  });
}
</script>

</body>
</html>
